# Amanzon VPC 보안

***네트워크 액세스 제어 목록(ACL)*** 은 서브넷 수준에서 특정 인바운드 또는 아웃바운드 트래픽을 허용하거나 거부합니다. VPC에 기본 네트워크 ACL을 사용하거나 보안 그룹에 대한 규칙과 유사한 규칙으로 VPC에 대한 사용자 지정 네트워크 ACL을 생성하여 VPC에 추가 보안 계층을 추가할 수 있습니다.

***보안 그룹*** 은 연결된 리소스에 도달하고 떠날 수 있는 트래픽을 제어합니다. 예를 들어 보안 그룹을 EC2 인스턴스와 연결하면 인스턴스의 인바운드 및 아웃바운드 트래픽을 제어합니다.

VPC를 생성하면 기본 보안 그룹이 함께 제공됩니다. 각 VPC에 대해 추가 보안 그룹을 생성할 수 있습니다. 보안 그룹은 생성된 VPC의 리소스와만 연결할 수 있습니다.

각 보안 그룹에 대해 프로토콜 및 포트 번호를 기반으로 트래픽을 제어하는 규칙을 추가합니다. 인바운드 트래픽과 아웃바운드 트래픽에 대한 별도의 규칙 세트가 있습니다.
</br></br>


## 네트워크 액세스 제어 목록이 있는 보안 서브넷
네트워크 액세스 제어 목록(네트워크 ACL)을 서브넷 수준의 방화벽으로 생각하십시오. **네트워크 ACL**을 사용하면 서브넷에 들어오거나 나갈 수 있는 트래픽의 종류를 제어할 수 있습니다. 필터링하려는 내용을 정의하는 규칙을 설정하여 이를 구성할 수 있습니다. 다음은 예입니다.
</br>

#### Inbound
| Rule #      | Type             | Protocol     | Port Range     | Source     | Allow/Deny     |
| ----------- | ---------------- | ------------ | -------------- | ---------- | -------------- |
| 100         | All IPv4 traffic | All          | All            | 0.0.0.0/0  | ALLOW          |
| *           | All IPv4 traffic | All          | All            | 0.0.0.0/0  | DENY           |

#### Outbound
| Rule #      | Type             | Protocol     | Port Range     | Source     | Allow/Deny     |
| ----------- | ---------------- | ------------ | -------------- | ---------- | -------------- |
| 100         | All IPv4 traffic | All          | All            | 0.0.0.0/0  | ALLOW          |
| *           | All IPv4 traffic | All          | All            | 0.0.0.0/0  | DENY           |

앞 표에 표시된 기본 네트워크 ACL은 서브넷을 드나드는 모든 트래픽을 허용합니다. 데이터가 서브넷으로 자유롭게 흐르도록 하기 위해, 이것은 좋은 출발점이다.

그러나 서브넷 수준에서 데이터를 제한할 수 있습니다. 예를 들어 웹 응용 프로그램이 있는 경우 웹 서버에 대한 HTTPS 트래픽 및 RDP(원격 데스크톱 프로토콜) 트래픽을 허용하도록 네트워크를 제한할 수 있습니다.
</br>

#### Inbound
| Rule #      | Source IP        | Protocol     | Port    | Allow/Deny | Comments                                   |
| ----------- | ---------------- | ------------ | ------- | ---------- | ------------------------------------------ |
| 100         | All IPv4 traffic | TCP          | 443     | ALLOW      | 어디서나 인바운드 HTTPS 트래픽 허용 |
| 130         | 192.0.2.0/24     | TCP          | 3389    | ALLOW      | 홈 네트워크의 공용 IP 주소 범위(인터넷 게이트웨이를 통해)에서 웹 서버로 인바운드 RDP 트래픽을 허용합니다. |
| *           | All IPv4 traffic | All          | All     | DENY       | 이전 규칙에 의해 이미 처리되지 않은 모든 인바운드 트래픽을 거부합니다(수정 불가) |

#### Outbound
| Rule #      | Destination IP   | Protocol     | Port           | Allow/Deny | Comments                                   |
| ----------- | ---------------- | ------------ | -------------- | ---------- | ------------------------------------------ |
| 120         | 0.0.0.0/0        | TCP          | 1025-65535     | ALLOW      | 인터넷상의 클라이언트에 대한 아웃바운드 응답 허용(서브넷의 웹 서버를 방문하는 사람들에게 서비스 제공) |
| *           | 0.0.0.0/0        | All          | All            | DENY       | 이전 규칙에 의해 아직 처리되지 않은 모든 아웃바운드 트래픽을 거부합니다(수정 불가). |

앞의 네트워크 ACL 예에서는 인바운드 443 및 아웃바운드 범위 1025–65535를 허용합니다. HTTP는 443번 포트를 사용하여 연결을 시작하고 임시 포트에 응답하기 때문입니다. 네트워크 ACL은 상태 없는 것으로 간주되므로 프로토콜에 사용되는 인바운드 및 아웃바운드 포트를 모두 포함해야 합니다. 아웃바운드 범위를 포함하지 않으면 서버가 응답하지만 트래픽은 서브넷을 떠나지 않습니다.

네트워크 ACL은 수신 및 발신 트래픽을 허용하도록 기본적으로 구성되어 있으므로 추가 보안 계층이 필요하지 않은 한 초기 설정을 변경할 필요가 없습니다.
</br></br>


## 보안 그룹으로 EC2 인스턴스 보안

다음 보안 계층은 EC2 인스턴스를 위한 것입니다. 여기서 **보안 그룹**이라는 방화벽을 만들 수 있습니다. 보안 그룹의 기본 구성은 모든 인바운드 트래픽을 차단하고 모든 아웃바운드 트래픽을 허용합니다.

![image](https://github.com/user-attachments/assets/396735ab-a6f5-42f7-8748-da6977f56f54)


"이로 인해 모든 EC2 인스턴스가 고객 요청에 대한 응답을 수신하지 못합니까?"라고 궁금해 할 수 있습니다. 음, 보안 그룹은 국가적입니다. 즉, 연결이 원래 EC2 인스턴스에 의해 시작되었는지 아니면 외부에서 시작되었는지 기억하고 인바운드 규칙을 수정하지 않고 일시적으로 트래픽이 응답하도록 허용할 것입니다.

EC2 인스턴스가 인터넷의 트래픽을 수락하려면 인바운드 포트를 열어야 합니다. 웹 서버가 있는 경우 해당 유형의 트래픽을 보안 그룹으로 허용하려면 HTTP 및 HTTPS 요청을 수락해야 할 수 있습니다. 그림과 같이 포트 80(HTTP)과 포트 443(HTTPS)을 허용하는 인바운드 규칙을 만들 수 있습니다.
